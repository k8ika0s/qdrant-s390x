# s390x (IBM Z / zLinux) Support

This repository contains ongoing work to make Qdrant build, test, and run on `s390x` (big-endian).

## Compatibility Goals

- Build from source on `s390x-unknown-linux-gnu`.
- Run the core service (`qdrant`) with RocksDB enabled.
- Keep persisted formats architecture-neutral (see `docs/PERSISTENCE_ENDIANNESS.md`).
- Provide regression coverage that prevents reintroducing endian-dependent persistence.

## CI Signals

Current CI provides two informational s390x lanes:

- `s390x check`: `cargo check -p qdrant --target s390x-unknown-linux-gnu`
- `s390x unit tests (qemu)`: runs a curated set of tests under `cross` + QEMU

These jobs are intentionally `continue-on-error` while the signal is being stabilized.

## Native Validation Gates

For native hosts (recommended for final validation), use:

```bash
tools/run-s390x-gates.sh
```

This writes per-stage logs under `dev-docs/s390x-validation/` by default.

Notes:

- Some stages are link- and disk-heavy. On shared/limited hosts, consider `CARGO_BUILD_JOBS=2` and
  ensure sufficient free disk space before running full workspace builds/tests.
- The gate sweep includes an ignored end-to-end HTTP smoke test (`tests/s390x_http_smoke.rs`) that:
  - boots Qdrant,
  - creates a collection and upserts points,
  - restarts Qdrant and re-queries persisted data.
  You can run it directly with:
  ```bash
  cargo test -p qdrant --features rocksdb --locked --test s390x_http_smoke -- --ignored
  ```

## Persistence Hygiene

When touching a persisted on-disk format:

1. Follow `docs/PERSISTENCE_ENDIANNESS.md` (canonical little-endian persistence).
2. Add or bump a version marker where practical.
3. Add migration/compatibility tests (including malformed-input tests).
4. Optionally run:

```bash
tools/check-persistence-endianness.sh <touched-file>...
```

This is a heuristic helper intended to catch obvious mistakes early.
